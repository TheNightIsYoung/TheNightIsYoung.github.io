<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Python 浮点数精确运算解决方案 - When Art Meets Tech</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="When Art Meets Tech"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="When Art Meets Tech"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="使用 Python 标准库中数字和数学模块 &amp;gt;&amp;gt;&amp;gt;&amp;gt; decimal 模块，实现 Python 浮点数精确运算，可以满足会计方面的应用和有高精度要求的应用场景。"><meta property="og:type" content="blog"><meta property="og:title" content="Python 浮点数精确运算解决方案"><meta property="og:url" content="https://www.orangeshare.cn/2018/01/08/python-fu-dian-shu-jing-que-yun-suan-jie-jue-fang-an/"><meta property="og:site_name" content="When Art Meets Tech"><meta property="og:description" content="使用 Python 标准库中数字和数学模块 &amp;gt;&amp;gt;&amp;gt;&amp;gt; decimal 模块，实现 Python 浮点数精确运算，可以满足会计方面的应用和有高精度要求的应用场景。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://www.orangeshare.cn/img/og_image.png"><meta property="article:published_time" content="2018-01-08T15:58:59.000Z"><meta property="article:modified_time" content="2022-11-06T14:49:48.715Z"><meta property="article:author" content="Waldeinsamkeit"><meta property="article:tag" content="DataType"><meta property="article:tag" content="Python"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.orangeshare.cn/2018/01/08/python-fu-dian-shu-jing-que-yun-suan-jie-jue-fang-an/"},"headline":"When Art Meets Tech","image":["https://www.orangeshare.cn/img/og_image.png"],"datePublished":"2018-01-08T15:58:59.000Z","dateModified":"2022-11-06T14:49:48.715Z","author":{"@type":"Person","name":"Waldeinsamkeit"},"description":"使用 Python 标准库中数字和数学模块 &gt;&gt;&gt;&gt; decimal 模块，实现 Python 浮点数精确运算，可以满足会计方面的应用和有高精度要求的应用场景。"}</script><link rel="canonical" href="https://www.orangeshare.cn/2018/01/08/python-fu-dian-shu-jing-que-yun-suan-jie-jue-fang-an/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Oxanium:wght@300;400;600&amp;family=Roboto+Mono"><link rel="stylesheet" href="/css/cyberpunk.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.2.0"></head>    <body class="is-3-column">    <nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="When Art Meets Tech" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Hexo Search" href="https://hexo.io/zh-cn/"><i class="fab fa-hotjar"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal"><i class="fas fa-angle-double-right"></i>Python 浮点数精确运算解决方案</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><i class="far fa-calendar-alt"> </i><time dateTime="${date_xml(page.date)}" title="${date_xml(page.date)}">2018-01-08</time></span><span class="level-item is-hidden-mobile"><i class="far fa-calendar-check"> </i><time dateTime="${date_xml(page.updated)}" title="${date_xml(page.updated)}">2022-11-06</time></span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a></span><span class="level-item">37 minutes read (About 5494 words)</span></div></div><div class="content"><p>使用 Python 标准库中数字和数学模块 &gt;&gt;&gt;&gt; <a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/decimal.html">decimal 模块</a>，实现 Python 浮点数精确运算，可以满足会计方面的应用和有高精度要求的应用场景。  </p>
<a id="more"></a>

<h2 id="前记"><a href="#前记" class="headerlink" title="前记"></a>前记</h2><p>前面的博文 [ &gt;&gt;&gt;&gt; <a href="https://www.orangeshare.cn/2016/08/01/bian-cheng-ji-chu-zhi-jin-zhi-xiang-jie/">编程基础之进制详解</a> &lt;&lt;&lt;&lt; ] 中提到过，在计算机中浮点数并不能准确的表示十进制，这是由于十进制小数在转换成计算机可识别、处理的二进制小数时，存在无限问题，此时计算机会在某个精度上直接进行舍入，以至于运算还没开始，一个很小的舍入错误就已经产生了。</p>
<p>而有误差的两个数，其运算的结果，很可能和我们的期望不一样了，例如：<code>0.1 + 0.2 &gt; 0.3</code>。详情可参见博文：[ &gt;&gt;&gt;&gt; <a href="https://www.orangeshare.cn/2016/07/29/wei-shi-me-0-1-0-2-bu-deng-yu-0-3/">为什么 0.1 + 0.2 不等于 0.3?</a> &lt;&lt;&lt;&lt; ]。</p>
<p>并且在运算（即便最简单的数学运算）中也会由于近似处理、内存限制等原因出现舍入误差。同时，上述种种的舍入误差会在后续的计算过程中不断传递累计，最终带来不可控制的后果。</p>
<hr>
<h2 id="Python-近似机制"><a href="#Python-近似机制" class="headerlink" title="Python 近似机制"></a>Python 近似机制</h2><p>这一小节的目的是认识一下 Python3 中浮点数的近似进制。</p>
<p>先不要运行 <code>round(1.115)</code>，考虑一下其结果是 <code>1.11</code> 还是 <code>1.12</code> ？？？</p>
<p>悄悄告诉你是（1.11），你猜对了么？！！</p>
<p>计算机中大多数小数是不精确的，例如 <code>1.115</code> 在计算机中实际上是 <code>1.1149999999999999911182</code>。当你对这个小数精确到小数点后两位的时候，实际上小数点后第三位是 <code>4</code>，所以四舍五入的结果为 <code>1.11</code>。</p>
<p>再来看一个在计算机中可精确表示的小数 <code>0.125</code>（不要问为什么是精确的，好好看前记中提供的博文外链），考虑一下 <code>round(0.125)</code> 结果是 <code>0.12</code> 还是 <code>0.13</code> ？？？</p>
<p>运行后你会发现，把 <code>0.125</code> 精确到小数点后两位，四舍五入结果是 <code>0.12</code>，为什么这里四舍了？？？</p>
<p>再来尝试一下 <code>round(0.375)</code>，其四舍五入结果是 <code>0.38</code>，这里为什么又五入了？！！</p>
<p>事实上 &gt;&gt;&gt;&gt;</p>
<p>Python3 中，<code>round</code> 对小数的精确度采用了 “<strong>四舍六入五成双</strong>” 的方式，需要使用 “<strong>奇进偶舍</strong>” 的处理方法进行判断。</p>
<p><strong>舍入判断规则 &gt;&gt;&gt;&gt;</strong></p>
<p><strong>[1]</strong> &gt;&gt;&gt;&gt; 对于一个小数 <code>a.bcd</code>，如需要精确到小数点后两位，那么就要看小数点后第三位。</p>
<p><strong>[2]</strong> &gt;&gt;&gt;&gt; 如果 <code>d &lt;= 4</code>，直接舍去；如果 <code>d &gt;= 6</code>，直接进位。</p>
<p><strong>[3]</strong> &gt;&gt;&gt;&gt; 如果 <code>d==5</code> &gt;&gt;&gt;&gt; 1）<code>d</code> 后面没有数据 &amp;&amp; <code>c</code> 为偶数：那么不进位，保留 <code>c</code>；2）<code>d</code> 后面没有数据 &amp;&amp; <code>c</code> 为奇数：那么进位，<code>c</code> —&gt; <code>c + 1</code>；3）<code>d</code> 后面有数据，直接进位，<code>c</code> —&gt; <code>c + 1</code>。</p>
<hr>
<p>谈到 Python 的近似机制，主要是由于在实际应用场景中都会涉及到精确度（近似）问题。就 Python 的浮点数运算而言，大多数计算机每次计算误差不会超过 2^53，但这对于大多数任务来说已经足够了。也就是说，<font color=red>我们允许（对结果无关紧要的）误差存在。</font></p>
<p>然而 &gt;&gt;&gt;&gt;</p>
<p>对于金融方面的应用和有高精度要求的应用场景，舍入误差就显得尤为明显了，这就需要用到 Python 中的 <strong>decimal</strong> 模块了。</p>
<h2 id="decimal-Module"><a href="#decimal-Module" class="headerlink" title="decimal Module"></a>decimal Module</h2><p>decimal 模块中，可以通过 <strong>整数，字符串，元组，或 浮点数</strong>，来构建 <code>decimal.Decimal</code> 对象，以实现精确计算。</p>
<p>先来看一个简单演示 —&gt; 如何使用 decimal 模块，使得 <code>0.1 + 0.2 == 0.3</code>（进行精确计算）？？？方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal</span><br><span class="line"></span><br><span class="line">a = Decimal(<span class="string">&#x27;0.1&#x27;</span>)</span><br><span class="line">b = Decimal(<span class="string">&#x27;0.2&#x27;</span>)</span><br><span class="line"><span class="built_in">sum</span> = a + b</span><br><span class="line"></span><br><span class="line">print(<span class="built_in">sum</span>, <span class="built_in">type</span>(<span class="built_in">sum</span>))</span><br><span class="line"><span class="comment"># 0.3 &lt;class &#x27;decimal.Decimal&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果是浮点数，特别注意因为浮点数本身存在误差，需要先将浮点数转化为字符串，再传入 Decimal。</p>
</blockquote>
<h3 id="易错点"><a href="#易错点" class="headerlink" title="易错点"></a>易错点</h3><p>容易出错的是 &gt;&gt;&gt;&gt;</p>
<p><strong>[1] &gt;&gt;&gt; 浮点数直接参与构建 Decimal 对象</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal</span><br><span class="line"></span><br><span class="line">a = Decimal(<span class="number">0.1</span>)</span><br><span class="line">b = Decimal(<span class="number">0.2</span>)</span><br><span class="line"><span class="built_in">sum</span> = a + b</span><br><span class="line"></span><br><span class="line">print(<span class="built_in">sum</span>, <span class="built_in">type</span>(<span class="built_in">sum</span>))</span><br><span class="line"><span class="comment"># 0.3000000000000000166533453694 &lt;class &#x27;decimal.Decimal&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到，此时浮点数未转换为字符串，直接用于构造 Decimal 对象，相当于没有用到精确计算。此时使用的是 <code>0.1</code> &amp;&amp; <code>0.2</code> 在计算机中的精确值,，可以打印出来看一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal</span><br><span class="line"></span><br><span class="line">a = Decimal(<span class="number">0.1</span>)</span><br><span class="line">print(a)</span><br><span class="line"><span class="comment"># 0.1000000000000000055511151231257827021181583404541015625</span></span><br><span class="line"></span><br><span class="line">b = Decimal(<span class="number">0.2</span>)</span><br><span class="line">print(b)</span><br><span class="line"><span class="comment"># 0.200000000000000011102230246251565404236316680908203125</span></span><br></pre></td></tr></table></figure>

<p>你可以想到的是：如果一个小数在计算机中是精确的，那么直接使用（未转换为字符串）其构建的 Decimal 对象值刚好就是小数本身的值。</p>
<hr>
<p><strong>[2] &gt;&gt;&gt; 混合操作 Decimal 和浮点数</strong></p>
<p>直接看样例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal</span><br><span class="line"></span><br><span class="line">a = Decimal(<span class="string">&#x27;0.1&#x27;</span>)</span><br><span class="line">b = <span class="number">0.125</span></span><br><span class="line">print(a + b)</span><br><span class="line"><span class="comment"># TypeError: unsupported operand type(s) for +: &#x27;decimal.Decimal&#x27; and &#x27;float&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Decimal 数值对象可以直接和整型（int）、布尔型（bool）数值进行计算。与浮点数或分数模块 <code>fractions.Fraction</code> 实例在算术运算中结合使用时会报错：TypeError（例如尝试将 Decimal 加到 float）。</p>
<p>但是，可以使用 Python 的比较运算符来比较 Decimal 实例 x 和另一个数字 y（浮点数也可以参与比较了）。</p>
<hr>
<h3 id="设置有效位数"><a href="#设置有效位数" class="headerlink" title="设置有效位数"></a>设置有效位数</h3><p>当使用十进制模块运算过程中出现无限小数时，可以通过设置 <strong>有效数字</strong> 来达到需要的目标精度：</p>
<p><strong>[1] &gt;&gt;&gt; decimal.getcontext().prec</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext</span><br><span class="line"></span><br><span class="line">getcontext().prec = <span class="number">6</span></span><br><span class="line">print(Decimal(<span class="number">1</span>)/Decimal(<span class="number">7</span>))        <span class="comment"># 0.142857</span></span><br><span class="line">print(<span class="number">1</span>/<span class="number">7</span>)      <span class="comment"># 0.14285714285714285</span></span><br></pre></td></tr></table></figure>

<p><strong>[2] &gt;&gt;&gt; quantize(Decimal(‘0.000’))</strong></p>
<p>在截取有效位数时，你也可以使用 quantize 方法来决定 <strong>保留几位小数</strong>，同时支持自定义四舍五入（舍入）机制，:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, ROUND_DOWN</span><br><span class="line"></span><br><span class="line">res = Decimal(<span class="number">1</span>)/Decimal(<span class="number">7</span>)</span><br><span class="line">print(res)      <span class="comment"># 0.1428571428571428571428571429</span></span><br><span class="line">res1 = res.quantize(Decimal(<span class="string">&#x27;0.000&#x27;</span>))        <span class="comment"># 四舍五入，保留3位有效数字</span></span><br><span class="line">print(res1)      <span class="comment"># 0.143</span></span><br><span class="line"></span><br><span class="line">res2 = res.quantize(Decimal(<span class="string">&#x27;0.000&#x27;</span>), rounding=ROUND_DOWN)        <span class="comment"># 向下舍入，保留3位有效数字</span></span><br><span class="line">print(res2)      <span class="comment"># 0.142</span></span><br><span class="line"></span><br><span class="line">print(res.quantize(Decimal(<span class="string">&#x27;.1&#x27;</span>)))    <span class="comment"># 0.1</span></span><br><span class="line">print(res.quantize(Decimal(<span class="string">&#x27;.01&#x27;</span>)))    <span class="comment"># 0.142</span></span><br><span class="line">print(res.quantize(Decimal(<span class="string">&#x27;1.&#x27;</span>)))    <span class="comment"># 0</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>你需要注意：保留有效数字 &amp;&amp; 保留小数点后几位 的区别！！！</p>
</blockquote>
<p>| &gt;&gt;&gt;&gt; ===================== <strong>需要注意的是</strong> ====================== &lt;&lt;&lt;&lt; |</p>
<p><strong>精度提升的同时，必然带来的是性能的损失。</strong> 在对数据要求特别精确的场合（例如财务结算），这些性能的损失是值得的。<br>但是如果是大规模的科学计算，就需要考虑运行效率了。毕竟原生的 <code>float</code> 比 <code>Decimal</code> 对象肯定是要快很多的。</p>
<hr>
<p>想要更好、更准确、更深入的使用 decimal 模块，你需要了解本章节内容，或者移步至 &gt;&gt;&gt;&gt; <a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/decimal.html#module-decimal">Python decimal 模块官方说明文档</a> &lt;&lt;&lt;&lt; 进行学习。</p>
<h2 id="You-Need-Know-More"><a href="#You-Need-Know-More" class="headerlink" title="You Need Know More"></a>You Need Know More</h2><p>Python 提供了 decimal 模块，用于支持正确舍入的十进制浮点算术。它具有如下特点：</p>
<p><strong>[1]</strong> &gt;&gt;&gt;&gt; <strong>Decimal 数字的表示是完全精确的</strong></p>
<p>相较于浮点数据类型，像 <code>1.1</code> &amp;&amp; <code>1.2</code> 这样的数字在二进制浮点中是没有精确表示的，最终用户通常不希望 <code>1.1 + 2.2</code> 如二进制浮点数表示那样被显示为 <code>3.3000000000000003</code>。</p>
<p><strong>[2]</strong> &gt;&gt;&gt;&gt; <strong>数字表示的精确性会延续到算术类操作中</strong></p>
<p>对于 decimal 浮点数，<code>0.1 + 0.1 + 0.1 - 0.3</code> 会精确地等于零。 而对于二进制浮点数，结果则为 <code>5.5511151231257827e-017</code> 。 虽然接近于零，但其中的误差将妨碍可靠的相等性检验，并且误差还会不断累积。 因此，decimal 更适合具有严格相等不变性要求的会计类应用。</p>
<p><strong>[3]</strong> &gt;&gt;&gt;&gt; <strong>decimal 模块包含有效位的概念</strong></p>
<p>Decimal 数字在计算后，会保留尾随零以表示有效位。例如：<code>1.30 + 1.20 = 2.50</code> &amp;&amp; <code>1.3 * 1.2 = 1.56</code> &amp;&amp; <code>1.30 * 1.20 = 1.5600</code> 等。</p>
<p><strong>[4]</strong> &gt;&gt;&gt;&gt; <strong>decimal 模块支持用户自定义精度（默认是 28 位）</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext</span><br><span class="line"></span><br><span class="line">print(Decimal(<span class="number">1</span>) / Decimal(<span class="number">7</span>))</span><br><span class="line"><span class="comment"># 0.1428571428571428571428571429</span></span><br><span class="line">getcontext().prec = <span class="number">6</span></span><br><span class="line">print(Decimal(<span class="number">1</span>) / Decimal(<span class="number">7</span>))</span><br><span class="line"><span class="comment"># 0.142857</span></span><br></pre></td></tr></table></figure>

<p><strong>[5]</strong> &gt;&gt;&gt;&gt; <strong>decimal 模块旨在支持“无偏差，精确无舍入的十进制算术（有时称为定点数算术）和有舍入的浮点数算术”</strong></p>
<hr>
<p>decimal 模块的设计以三个概念为中心：<strong>decimal 数值（Decimal）</strong>，<strong>算术上下文（Context）</strong>，以及 <strong>信号</strong>。</p>
<h3 id="decimal-数值（Decimal）"><a href="#decimal-数值（Decimal）" class="headerlink" title="decimal 数值（Decimal）"></a>decimal 数值（Decimal）</h3><p>decimal 数值是不可变对象，它由符号，系数和指数位组成。并且为了保持有效位，系数位不会截去末尾零。</p>
<p><strong>[1]</strong> &gt;&gt;&gt;&gt; 构建 Decimal 实例</p>
<p>前面我们提到过，可以基于整数、字符串、浮点数或元组构造 Decimal 实例。decimal 数值中还可以是一些特殊值，例如 <code>Infinity</code> ，<code>-Infinity</code> 和 <code>NaN</code>，还区分 <code>-0</code> 和 <code>+0</code>。</p>
<p>来看一些构建实例 &gt;&gt;&gt;&gt;</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal</span><br><span class="line"></span><br><span class="line">print(Decimal(<span class="number">10</span>))</span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line">print(Decimal(<span class="string">&#x27;3.14&#x27;</span>))</span><br><span class="line"><span class="comment"># 3.14</span></span><br><span class="line">print(Decimal(<span class="number">3.14</span>))</span><br><span class="line"><span class="comment"># 3.140000000000000124344978758017532527446746826171875</span></span><br><span class="line">print(Decimal((<span class="number">0</span>, (<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>), -<span class="number">2</span>)))</span><br><span class="line"><span class="comment"># 3.14</span></span><br><span class="line">print(Decimal(<span class="built_in">str</span>(<span class="number">2.0</span> ** <span class="number">0.5</span>)))</span><br><span class="line"><span class="comment"># 1.4142135623730951</span></span><br><span class="line">print(Decimal(<span class="number">2</span>) ** Decimal(<span class="string">&#x27;0.5&#x27;</span>))</span><br><span class="line"><span class="comment"># 1.414213562373095048801688724</span></span><br><span class="line">print(Decimal(<span class="string">&#x27;NaN&#x27;</span>))</span><br><span class="line"><span class="comment"># NaN</span></span><br><span class="line">print(Decimal(<span class="string">&#x27;-Infinity&#x27;</span>))</span><br><span class="line"><span class="comment"># -Infinity</span></span><br><span class="line">print(Decimal(<span class="string">&#x27;-0&#x27;</span>))</span><br><span class="line"><span class="comment"># -0</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果使用 <strong>tuple</strong> 进行构建，它应该有三个组件：一个符号（ 0 表示正数或 1 表示负数），一个数字的 tuple 和整数指数。 例如：Decimal((0, (1, 4, 1, 4), -3)) 返回 Decimal(‘1.414’)。</p>
</blockquote>
<hr>
<p><strong>[2]</strong> &gt;&gt;&gt;&gt; decimal 模块可以和 Python 其它部分很好交互。</p>
<p>直接来看实例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; data = list(map(Decimal, <span class="string">&#x27;1.34 1.87 3.45 2.35 1.00 0.03 9.25&#x27;</span>.split()))</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; max(data)</span></span><br><span class="line">Decimal(&#x27;9.25&#x27;)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; min(data)</span></span><br><span class="line">Decimal(&#x27;0.03&#x27;)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; sorted(data)</span></span><br><span class="line">[Decimal(&#x27;0.03&#x27;), Decimal(&#x27;1.00&#x27;), Decimal(&#x27;1.34&#x27;), Decimal(&#x27;1.87&#x27;),</span><br><span class="line"> Decimal(&#x27;2.35&#x27;), Decimal(&#x27;3.45&#x27;), Decimal(&#x27;9.25&#x27;)]</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; sum(data)</span></span><br><span class="line">Decimal(&#x27;19.29&#x27;)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; a,b,c = data[:3]</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; str(a)</span></span><br><span class="line">&#x27;1.34&#x27;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; <span class="built_in">float</span>(a)</span></span><br><span class="line">1.34</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; round(a, 1)</span></span><br><span class="line">Decimal(&#x27;1.3&#x27;)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; int(a)</span></span><br><span class="line">1</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; a * 5</span></span><br><span class="line">Decimal(&#x27;6.70&#x27;)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; a * b</span></span><br><span class="line">Decimal(&#x27;2.5058&#x27;)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; c % a</span></span><br><span class="line">Decimal(&#x27;0.77&#x27;)</span><br></pre></td></tr></table></figure>

<p>Decimal 也可以使用一些数学函数：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; getcontext().prec = 28</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Decimal(2).sqrt()</span></span><br><span class="line">Decimal(&#x27;1.414213562373095048801688724&#x27;)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Decimal(1).exp()</span></span><br><span class="line">Decimal(&#x27;2.718281828459045235360287471&#x27;)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Decimal(<span class="string">&#x27;10&#x27;</span>).ln()</span></span><br><span class="line">Decimal(&#x27;2.302585092994045684017991455&#x27;)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Decimal(<span class="string">&#x27;10&#x27;</span>).log10()</span></span><br><span class="line">Decimal(&#x27;1&#x27;)</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>[3]</strong> &gt;&gt;&gt;&gt; 构建的 Decimal 的重要性仅由输入的数值决定， 上下文精度和舍入仅在算术运算期间发挥作用。</p>
<p>例如，上面我们通过 <code>getcontext().prec = 6</code> 这样的语句设置过精度，这就是通过算术上下文实现的。它无法影响一个新创建的 Decimal 对象的存储位数。</p>
<blockquote>
<p>这里不理解也没关系，你可以通过先学习下面的【算术上下文（Context）】之后，再来进行理解学习。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext</span><br><span class="line"></span><br><span class="line">getcontext().prec = <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 仅由输出数值的位数决定，上下文精度未发挥作用：</span></span><br><span class="line">print(Decimal(<span class="string">&#x27;3.0&#x27;</span>))</span><br><span class="line"><span class="comment"># 3.0</span></span><br><span class="line">print(Decimal(<span class="string">&#x27;3.1415926535&#x27;</span>))</span><br><span class="line"><span class="comment"># 3.1415926535</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上下文精度在运算时发挥作用：</span></span><br><span class="line">print(Decimal(<span class="string">&#x27;3.1415926535&#x27;</span>) + Decimal(<span class="string">&#x27;2.7182818285&#x27;</span>))</span><br><span class="line"><span class="comment"># 5.85987</span></span><br></pre></td></tr></table></figure>

<p>后面你还会学到 <code>getcontext().rounding = ROUND_UP</code> 这样的语句，来设置运算时的舍入规则。它也仅在运算时生效。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext</span><br><span class="line"></span><br><span class="line">getcontext().prec = <span class="number">6</span></span><br><span class="line">getcontext().rounding = ROUND_UP</span><br><span class="line"></span><br><span class="line">print(Decimal(<span class="string">&#x27;3.1415926535&#x27;</span>))</span><br><span class="line"><span class="comment"># 3.1415926535</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 舍入规则在运算时发挥作用：</span></span><br><span class="line">print(Decimal(<span class="string">&#x27;3.1415926535&#x27;</span>) + Decimal(<span class="string">&#x27;2.7182818285&#x27;</span>))</span><br><span class="line"><span class="comment"># 5.85988</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="算术上下文（Context）"><a href="#算术上下文（Context）" class="headerlink" title="算术上下文（Context）"></a>算术上下文（Context）</h3><p>算术上下文是指算术运算所在的环境 &gt;&gt;&gt;&gt; 用于管理 decimal 模块算术运算期间的，精度、舍入规则、指数的限制范围，以及确定将哪些信号视为异常。</p>
<p><strong>[1]</strong> &gt;&gt;&gt;&gt; getcontext() 函数</p>
<p>你可以通过 <code>getcontext()</code> 来查看当前的上下文环境，并在必要时为精度、舍入或启用的陷阱设置新值:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用前，记得导入</span></span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> getcontext</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以看到：是一个名为 `Context` 的上下文环境对象。</span></span><br><span class="line"><span class="comment"># 其中，`prec` 属性表示：精度</span></span><br><span class="line"><span class="comment"># `rounding` 属性表示：舍入规则</span></span><br><span class="line"><span class="comment"># `Emin` &amp;&amp; `Emax` 属性分别表示：指数最小值和指数最大值</span></span><br><span class="line"><span class="comment"># `flags` &amp;&amp; `traps` 属性分别表示：信号中的标志和陷阱启动器（不用深究，说明见下文【信号】章节）</span></span><br><span class="line">print(getcontext())</span><br><span class="line"><span class="comment"># Context(prec=6, rounding=ROUND_UP, Emin=-999999, Emax=999999, capitals=1, clamp=0, flags=[], traps=[InvalidOperation, DivisionByZero, Overflow])</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">getcontext().prec = <span class="number">7</span>       <span class="comment"># Set a new precision</span></span><br><span class="line">getcontext().rounding=ROUND_DOWN <span class="comment"># Set a new rounding</span></span><br></pre></td></tr></table></figure>

<p>其中，上下文中支持的舍入（rounding）规则选项全集以及其解释如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 这里不用深究其参数含义，后续会通过实例进行说明</span><br><span class="line">ROUND_CEILING (towards Infinity),</span><br><span class="line">ROUND_DOWN (towards zero),</span><br><span class="line">ROUND_FLOOR (towards -Infinity),</span><br><span class="line">ROUND_HALF_DOWN (to nearest with ties going towards zero),</span><br><span class="line">ROUND_HALF_EVEN (to nearest with ties going to nearest even integer),</span><br><span class="line">ROUND_HALF_UP (to nearest with ties going away from zero), or</span><br><span class="line">ROUND_UP (away from zero).</span><br><span class="line">ROUND_05UP (away from zero if last digit after rounding towards zero would have been 0 or 5; otherwise towards zero)</span><br></pre></td></tr></table></figure>

<p>如上所示，<code>getcontext()</code> 函数访问当前上下文并允许更改设置，大多数程序仅在程序开始时调整当前上下文一次，这种方法满足大多数应用程序的需求。</p>
<hr>
<p><strong>[2]</strong> &gt;&gt;&gt;&gt; setcontext() 函数 &amp;&amp; Context() 构建函数</p>
<p>而对于更复杂的任务，例如你需要创建一个备用的上下文环境以便在某些情况下使用，你可以通过 <code>Context()</code> 构造函数创建一个备用的上下文，并且通过 <code>setcontext()</code> 函数来修改当前上下文。</p>
<blockquote>
<p>Context 构造函数格式：decimal.Context(prec=None, rounding=None, Emin=None, Emax=None, capitals=None, clamp=None, flags=None, traps=None)</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext, setcontext, Context, ROUND_UP</span><br><span class="line"></span><br><span class="line">print(getcontext())</span><br><span class="line"><span class="comment"># Context(prec=28, rounding=ROUND_HALF_EVEN, Emin=-999999, Emax=999999, capitals=1, clamp=0, flags=[], traps=[InvalidOperation, DivisionByZero, Overflow])</span></span><br><span class="line">print(Decimal(<span class="number">1</span>) / Decimal(<span class="number">7</span>))</span><br><span class="line"><span class="comment"># 0.1428571428571428571428571429</span></span><br><span class="line"></span><br><span class="line">myothercontext = Context(prec=<span class="number">40</span>, rounding=ROUND_UP)</span><br><span class="line">setcontext(myothercontext)</span><br><span class="line">print(Decimal(<span class="number">1</span>) / Decimal(<span class="number">7</span>))</span><br><span class="line"><span class="comment"># 0.1428571428571428571428571428571428571429</span></span><br><span class="line">print(getcontext())</span><br><span class="line"><span class="comment"># Context(prec=40, rounding=ROUND_UP, Emin=-999999, Emax=999999, capitals=1, clamp=0, flags=[Inexact, Rounded], traps=[InvalidOperation, DivisionByZero, Overflow])</span></span><br></pre></td></tr></table></figure>

<p>并且，decimal 模块提供了两个现成的标准上下文 <code>BasicContext</code> 和 <code>ExtendedContext</code>。</p>
<ol>
<li>decimal.BasicContext：精度设为 <code>9</code>；舍入设为 <code>ROUND_HALF_UP</code>；清除所有旗标；启用所有陷阱（视为异常），但 <code>Inexact</code>, <code>Rounded</code> 和 <code>Subnormal</code> 除外（由于启用了许多陷阱，此上下文适用于进行调试）。</li>
<li>decimal.ExtendedContext：精度设为 <code>9</code>；舍入设为 <code>ROUND_HALF_EVEN</code>；清除所有旗标；不启用任何陷阱（因此在计算期间不会引发异常）。由于禁用了陷阱，此上下文适用于希望结果值为 <code>NaN</code> 或 <code>Infinity</code> 而不是引发异常的应用。 这允许应用在出现当其他情况下会中止程序的条件时仍能完成运行。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext, setcontext, ExtendedContext, BasicContext</span><br><span class="line"></span><br><span class="line">print(getcontext())</span><br><span class="line"><span class="comment"># Context(prec=28, rounding=ROUND_HALF_EVEN, Emin=-999999, Emax=999999, capitals=1, clamp=0, flags=[], traps=[InvalidOperation, DivisionByZero, Overflow])</span></span><br><span class="line">print(Decimal(<span class="number">1</span>) / Decimal(<span class="number">7</span>))</span><br><span class="line"><span class="comment"># 0.1428571428571428571428571429</span></span><br><span class="line"></span><br><span class="line">print(ExtendedContext)</span><br><span class="line"><span class="comment"># Context(prec=9, rounding=ROUND_HALF_EVEN, Emin=-999999, Emax=999999, capitals=1, clamp=0, flags=[], traps=[])</span></span><br><span class="line">setcontext(ExtendedContext)</span><br><span class="line">print(Decimal(<span class="number">1</span>) / Decimal(<span class="number">7</span>))</span><br><span class="line"><span class="comment"># 0.142857143</span></span><br><span class="line">print(Decimal(<span class="number">23</span>) / Decimal(<span class="number">0</span>))</span><br><span class="line"><span class="comment"># Infinity</span></span><br><span class="line"></span><br><span class="line">print(BasicContext)</span><br><span class="line">Context(prec=<span class="number">9</span>, rounding=ROUND_HALF_UP, Emin=-<span class="number">999999</span>, Emax=<span class="number">999999</span>, capitals=<span class="number">1</span>, clamp=<span class="number">0</span>, flags=[], traps=[Clamped, InvalidOperation, DivisionByZero, Overflow, Underflow])</span><br><span class="line">setcontext(BasicContext)</span><br><span class="line">print(Decimal(<span class="number">23</span>) / Decimal(<span class="number">0</span>))</span><br><span class="line"><span class="comment"># DivisionByZero    Traceback (most recent call last)</span></span><br><span class="line"><span class="comment"># ---&gt; print(Decimal(23) / Decimal(0))</span></span><br><span class="line"><span class="comment"># DivisionByZero: [&lt;class &#x27;decimal.DivisionByZero&#x27;&gt;]</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="信号"><a href="#信号" class="headerlink" title="信号"></a>信号</h3><p>信号是 &gt;&gt;&gt;&gt; 在算术过程中可能出现的 <strong>异常条件组</strong>。并且根据应用程序的需要，信号可能会被忽略，被视为信息，或被视为异常。</p>
<p>decimal 模块中的信号有：<code>Clamped</code>、<code>InvalidOperation</code>、<code>DivisionByZero</code>、<code>Inexact</code>、<code>Rounded</code>、<code>Subnormal</code>、<code>Overflow</code>、<code>Underflow</code> 以及 <code>FloatOperation</code>。</p>
<p>对于每个信号，都有一个标志（flag）和一个陷阱启动器（trap）。遇到信号时，其标志会被设置为 1 ；然后，如果相应陷阱启用器也设置为 1，则引发异常。需要注意的是，标志是粘性的，因此用户需要在监控计算之前重置它们。</p>
<p><strong>[1] &gt;&gt;&gt;&gt;</strong> 如何查看检测到的信号标志，以及启动相应陷阱：</p>
<blockquote>
<p>并且，信号的标志（flags）以及陷阱启动器（trips）设置，也是由算术上下文进行管理的，分别对应 <code>Context</code> 中的 <code>flags</code> &amp;&amp; <code>traps</code> 字段。</p>
</blockquote>
<p>例如，在标准上下文 <code>ExtendedContext</code> 中，使用上下文的 traps 字段中的字典设置单个陷阱 <code>DivisionByZero</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext, setcontext, DivisionByZero</span><br><span class="line"></span><br><span class="line">setcontext(ExtendedContext)</span><br><span class="line">print(getcontext())</span><br><span class="line"><span class="comment"># Context(prec=9, rounding=ROUND_HALF_EVEN, Emin=-999999, Emax=999999, capitals=1, clamp=0, flags=[], traps=[])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 产生一个 `DivisionByZero` 信号，由于上下文中未启用陷阱故不引发异常，结果返回 `Infinity` ：</span></span><br><span class="line">print(Decimal(<span class="number">1</span>) / Decimal(<span class="number">0</span>))</span><br><span class="line"><span class="comment"># Infinity</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测到 `DivisionByZero` 信号，上下文中其标志被设置为 1（True），可见结果中 `flags=[DivisionByZero]`：</span></span><br><span class="line">print(getcontext())</span><br><span class="line"><span class="comment"># Context(prec=9, rounding=ROUND_HALF_EVEN, Emin=-999999, Emax=999999, capitals=1, clamp=0, flags=[DivisionByZero], traps=[])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 `DivisionByZero` 陷阱启动器为 1，即开启陷阱，可见结果中 `traps=[DivisionByZero]`：</span></span><br><span class="line">getcontext().traps[DivisionByZero] = <span class="number">1</span></span><br><span class="line">print(getcontext())</span><br><span class="line"><span class="comment"># Context(prec=9, rounding=ROUND_HALF_EVEN, Emin=-999999, Emax=999999, capitals=1, clamp=0, flags=[DivisionByZero], traps=[DivisionByZero])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 `DivisionByZero` 陷阱启动器为 1 之后，当检测到 `DivisionByZero` 信号时，会产生异常：</span></span><br><span class="line">print(Decimal(<span class="number">1</span>) / Decimal(<span class="number">0</span>))</span><br><span class="line"><span class="comment"># DivisionByZero    Traceback (most recent call last)</span></span><br><span class="line"><span class="comment"># ---&gt; print(Decimal(1) / Decimal(0))</span></span><br><span class="line"><span class="comment"># DivisionByZero: [&lt;class &#x27;decimal.DivisionByZero&#x27;&gt;]</span></span><br></pre></td></tr></table></figure>

<p>另外，设置 <code>FloatOperation</code> 陷阱之后，如果其信号被捕获，Decimal 构造函数中的小数和浮点数的意外混合或排序比较会引发异常：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext, FloatOperation</span><br><span class="line"></span><br><span class="line">c = getcontext()</span><br><span class="line">c.traps[FloatOperation] = <span class="literal">True</span></span><br><span class="line">print(c)</span><br><span class="line"></span><br><span class="line">Decimal(<span class="number">3.14</span>)</span><br><span class="line"><span class="comment"># Traceback (most recent call last):</span></span><br><span class="line"><span class="comment"># decimal.FloatOperation: [&lt;class &#x27;decimal.FloatOperation&#x27;&gt;]</span></span><br><span class="line"></span><br><span class="line">Decimal(<span class="string">&#x27;3.5&#x27;</span>) &lt; <span class="number">3.7</span></span><br><span class="line"><span class="comment"># Traceback (most recent call last):</span></span><br><span class="line"><span class="comment"># decimal.FloatOperation: [&lt;class &#x27;decimal.FloatOperation&#x27;&gt;]</span></span><br><span class="line"></span><br><span class="line">Decimal(<span class="string">&#x27;3.5&#x27;</span>) == <span class="number">3.5</span></span><br><span class="line"><span class="comment"># True</span></span><br></pre></td></tr></table></figure>

<hr>
<p><strong>[2] &gt;&gt;&gt;&gt;</strong> 信号粘性标志清除</p>
<p>我们知道，上下文环境可以监视到计算期间遇到的异常情况的信号标志，由于标志的粘性，其会保持设置直到明确清除。你可以使用 <code>clear_flags()</code> 方法清除每组受监控计算之前的标志:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext, ExtendedContext</span><br><span class="line"></span><br><span class="line">print(getcontext())</span><br><span class="line"><span class="comment"># Context(prec=28, rounding=ROUND_HALF_EVEN, Emin=-999999, Emax=999999, capitals=1, clamp=0, flags=[], traps=[InvalidOperation, DivisionByZero, Overflow])</span></span><br><span class="line"></span><br><span class="line">print(Decimal(<span class="number">355</span>) / Decimal(<span class="number">113</span>))</span><br><span class="line"><span class="comment"># 3.141592920353982300884955752</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可见，`flags` 条目中显示对 `Pi` 的有理逼近被舍入（Inexact，超出上下文精度的数字被抛弃），并且结果是不精确的（Rounded，一些丢弃的数字不为零）。</span></span><br><span class="line">print(getcontext())</span><br><span class="line"><span class="comment"># Context(prec=28, rounding=ROUND_HALF_EVEN, Emin=-999999, Emax=999999, capitals=1, clamp=0, flags=[Inexact, Rounded], traps=[InvalidOperation, DivisionByZero, Overflow])</span></span><br><span class="line"></span><br><span class="line">getcontext().clear_flags()</span><br><span class="line">print(getcontext())</span><br><span class="line"><span class="comment"># Context(prec=28, rounding=ROUND_HALF_EVEN, Emin=-999999, Emax=999999, capitals=1, clamp=0, flags=[], traps=[InvalidOperation, DivisionByZero, Overflow])</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Python-浮点数和十进制模块测试"><a href="#Python-浮点数和十进制模块测试" class="headerlink" title="Python 浮点数和十进制模块测试"></a>Python 浮点数和十进制模块测试</h2><p>这一小节，我们通过具体的代码来比较浮点数（float）和十进制（decimal）模块的差异：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> ROUND_UP, ROUND_DOWN, ROUND_CEILING, ROUND_FLOOR, ROUND_HALF_UP, ROUND_HALF_DOWN, ROUND_HALF_EVEN, ROUND_05UP</span><br><span class="line"></span><br><span class="line">x = <span class="number">4.20</span></span><br><span class="line">y = <span class="number">2.10</span></span><br><span class="line">a = <span class="number">1.10</span></span><br><span class="line">b = <span class="number">2.30</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">float_calculate</span>():</span></span><br><span class="line">    <span class="built_in">sum</span> = x + y</span><br><span class="line">    print(<span class="built_in">sum</span>)  <span class="comment"># 6.300000000000001</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">sum</span> == <span class="number">6.30</span>:</span><br><span class="line">        print(<span class="string">&quot;Floating-point number addition is a precise calculations.&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;Floating-point number addition is a Inexact operations.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    sub = a - b</span><br><span class="line">    print(sub)  <span class="comment"># -1.1999999999999997</span></span><br><span class="line">    <span class="keyword">if</span> sub == -<span class="number">1.2</span>:</span><br><span class="line">        print(<span class="string">&quot;Floating-point number subtraction is a precise calculations.&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;Floating-point number subtraction is a Inexact operations.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    mul = x * a</span><br><span class="line">    print(mul)  <span class="comment"># 4.620000000000001</span></span><br><span class="line">    <span class="keyword">if</span> mul == <span class="number">4.62</span>:</span><br><span class="line">        print(</span><br><span class="line">            <span class="string">&quot;Floating-point number multiplication is a precise calculations.&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;Floating-point number multiplication is a Inexact operations.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    div = x / <span class="number">0.7</span></span><br><span class="line">    print(div)  <span class="comment"># 6.000000000000001</span></span><br><span class="line">    <span class="keyword">if</span> div == <span class="number">6.0</span>:</span><br><span class="line">        print(<span class="string">&quot;Floating-point number division is a precise calculations.&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;Floating-point number division is a Inexact operations.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    e_round = <span class="built_in">round</span>(<span class="number">195.00</span> / <span class="number">24</span>, <span class="number">2</span>)</span><br><span class="line">    print(e_round)  <span class="comment"># 8.12</span></span><br><span class="line">    <span class="keyword">if</span> e_round == <span class="number">8.13</span>:</span><br><span class="line">        print(<span class="string">&quot;Floating-point number rounding is a precise operations.&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;Floating-point number rounding is a Inexact operations.&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decimal_calculate</span>():</span></span><br><span class="line">    getcontext().prec = <span class="number">3</span>  <span class="comment"># 设置 3 位有效数字</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">sum</span> = Decimal(<span class="built_in">str</span>(x)) + Decimal(<span class="built_in">str</span>(y))</span><br><span class="line">    print(<span class="built_in">type</span>(<span class="built_in">sum</span>), <span class="built_in">sum</span>)  <span class="comment"># &lt;class &#x27;decimal.Decimal&#x27;&gt; 6.3</span></span><br><span class="line"></span><br><span class="line">    e_result = Decimal(<span class="string">&quot;195.00&quot;</span>) / Decimal(<span class="string">&quot;24&quot;</span>)</span><br><span class="line">    print(e_result)  <span class="comment"># 8.12</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">float_info</span>():</span></span><br><span class="line">    <span class="comment"># a.bcd &gt;&gt;&gt;&gt; 精确到小数点后 2 位</span></span><br><span class="line">    i = <span class="number">1.115</span>  <span class="comment"># 在计算机中实际上是: 1.1149999999999999911182          四舍五入：1.11</span></span><br><span class="line">    j = <span class="number">0.125</span>  <span class="comment"># d 后面没有数据，且 c 为偶数，那么不进位，保留 c         四舍五入：0.12</span></span><br><span class="line">    k = <span class="number">0.1251</span>  <span class="comment"># d 后面有数据，c --&gt; (c + 1)                          四舍五入：0.13</span></span><br><span class="line">    m = <span class="number">0.375</span>  <span class="comment"># d 后面没有数据，且 c 为奇数，那么进位，c --&gt; (c + 1)   四舍五入：0.38</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;round(1.115) &gt;&gt;&gt;&gt;&quot;</span>, <span class="built_in">round</span>(i, <span class="number">2</span>))</span><br><span class="line">    print(<span class="string">&quot;round(0.125) &gt;&gt;&gt;&gt;&quot;</span>, <span class="built_in">round</span>(j, <span class="number">2</span>))</span><br><span class="line">    print(<span class="string">&quot;round(0.1251) &gt;&gt;&gt;&gt;&quot;</span>, <span class="built_in">round</span>(k, <span class="number">2</span>))</span><br><span class="line">    print(<span class="string">&quot;round(0.375) &gt;&gt;&gt;&gt;&quot;</span>, <span class="built_in">round</span>(m, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decimal_info</span>():</span></span><br><span class="line">    <span class="comment"># a.bcd &gt;&gt;&gt;&gt; 精确到小数点后 2 位</span></span><br><span class="line">    i = <span class="number">1.115</span>  <span class="comment"># 在计算机中实际上是: 1.1149999999999999911182          四舍五入：1.11</span></span><br><span class="line">    j = <span class="number">0.125</span>  <span class="comment"># d 后面没有数据，且 c 为偶数，那么不进位，保留 c         四舍五入：0.12</span></span><br><span class="line">    k = <span class="number">0.1251</span>  <span class="comment"># d 后面有数据，c --&gt; (c + 1)                          四舍五入：0.13</span></span><br><span class="line">    m = <span class="number">0.375</span>  <span class="comment"># d 后面没有数据，且 c 为奇数，那么进位，c --&gt; (c + 1)   四舍五入：0.38</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;浮点数数据不精确 &gt;&gt;&gt;&quot;</span>, Decimal(i))</span><br><span class="line">    print(<span class="string">&quot;浮点数数据精确 &gt;&gt;&gt;&quot;</span>, Decimal(i))</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;默认上下文环境 &gt;&gt;&gt;&quot;</span>, getcontext())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 默认四舍五入 &gt;&gt;&gt;&gt; 规则：四舍六入五成双，奇进偶舍</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是浮点型默认方式四舍五入：&#x27;</span>, Decimal(i).quantize(Decimal(<span class="string">&#x27;0.00&#x27;</span>)))  <span class="comment"># 1.11</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是浮点型默认方式四舍五入：&#x27;</span>, Decimal(j).quantize(Decimal(<span class="string">&#x27;0.00&#x27;</span>)))  <span class="comment"># 0.12</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是浮点型默认方式四舍五入：&#x27;</span>, Decimal(k).quantize(Decimal(<span class="string">&#x27;0.00&#x27;</span>)))  <span class="comment"># 0.13</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是浮点型默认方式四舍五入：&#x27;</span>, Decimal(m).quantize(Decimal(<span class="string">&#x27;0.00&#x27;</span>)))  <span class="comment"># 0.38</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是字符串默认方式四舍五入：&#x27;</span>,</span><br><span class="line">          Decimal(<span class="built_in">str</span>(i)).quantize(Decimal(<span class="string">&#x27;0.00&#x27;</span>)))  <span class="comment"># 1.12</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 真实四舍五入 &gt;&gt;&gt;&gt; 规则：四舍五入</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是字符串真实四舍五入：&#x27;</span>,</span><br><span class="line">          Decimal(<span class="built_in">str</span>(i)).quantize(Decimal(<span class="string">&#x27;0.00&#x27;</span>), ROUND_HALF_UP))  <span class="comment"># 1.12</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是字符串真实四舍五入：&#x27;</span>,</span><br><span class="line">          Decimal(<span class="built_in">str</span>(j)).quantize(Decimal(<span class="string">&#x27;0.00&#x27;</span>), ROUND_HALF_UP))  <span class="comment"># 0.13</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是字符串真实四舍五入：&#x27;</span>,</span><br><span class="line">          Decimal(<span class="built_in">str</span>(k)).quantize(Decimal(<span class="string">&#x27;0.00&#x27;</span>), ROUND_HALF_UP))  <span class="comment"># 0.13</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是字符串真实四舍五入：&#x27;</span>,</span><br><span class="line">          Decimal(<span class="built_in">str</span>(m)).quantize(Decimal(<span class="string">&#x27;0.00&#x27;</span>), ROUND_HALF_UP))  <span class="comment"># 0.38</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;传入的是字符串向上取值：&quot;</span>,</span><br><span class="line">          Decimal(<span class="string">&quot;0.121&quot;</span>).quantize(Decimal(<span class="string">&quot;0.00&quot;</span>), ROUND_UP))  <span class="comment"># 0.13</span></span><br><span class="line">    print(<span class="string">&quot;传入的是字符串向下取值：&quot;</span>,</span><br><span class="line">          Decimal(<span class="string">&quot;0.129&quot;</span>).quantize(Decimal(<span class="string">&quot;0.00&quot;</span>), ROUND_DOWN))  <span class="comment"># 0.12</span></span><br><span class="line">    print(<span class="string">&quot;传入的是字符串向上真实四舍五入：&quot;</span>,</span><br><span class="line">          Decimal(<span class="string">&quot;0.125&quot;</span>).quantize(Decimal(<span class="string">&quot;0.00&quot;</span>),</span><br><span class="line">                                    ROUND_HALF_UP))  <span class="comment"># 最后一位是 5 向上入：0.13</span></span><br><span class="line">    print(<span class="string">&quot;传入的是字符串向下四舍五入：&quot;</span>,</span><br><span class="line">          Decimal(<span class="string">&quot;0.125&quot;</span>).quantize(Decimal(<span class="string">&quot;0.00&quot;</span>),</span><br><span class="line">                                    ROUND_HALF_DOWN))  <span class="comment"># 最后一位是 5 向下舍：0.12</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是字符串默认方式四舍五入：&#x27;</span>,</span><br><span class="line">          Decimal(<span class="string">&#x27;0.125&#x27;</span>).quantize(</span><br><span class="line">              Decimal(<span class="string">&#x27;0.00&#x27;</span>), ROUND_HALF_EVEN))  <span class="comment"># 默认四舍五入：0.12（quantize 默认设置）</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是字符串默认方式四舍五入：&#x27;</span>,</span><br><span class="line">          Decimal(<span class="string">&#x27;0.375&#x27;</span>).quantize(</span><br><span class="line">              Decimal(<span class="string">&#x27;0.00&#x27;</span>), ROUND_HALF_EVEN))  <span class="comment"># 默认四舍五入：0.38（quantize 默认设置）</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是字符串精确位数字为 5 入：&#x27;</span>,</span><br><span class="line">          Decimal(<span class="string">&#x27;5.351&#x27;</span>).quantize(</span><br><span class="line">              Decimal(<span class="string">&#x27;0.00&#x27;</span>), ROUND_05UP))  <span class="comment"># 精确的最后一位为 0 或者 5 向上入，否者向下舍：5.36</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是字符串精确位数字为 0 入：&#x27;</span>,</span><br><span class="line">          Decimal(<span class="string">&#x27;5.301&#x27;</span>).quantize(</span><br><span class="line">              Decimal(<span class="string">&#x27;0.00&#x27;</span>), ROUND_05UP))  <span class="comment"># 精确的最后一位为 0 或者 5 向上入，否者向下舍：5.31</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是字符串精确位数字非 0 和 5 舍：&#x27;</span>,</span><br><span class="line">          Decimal(<span class="string">&#x27;5.399&#x27;</span>).quantize(</span><br><span class="line">              Decimal(<span class="string">&#x27;0.00&#x27;</span>), ROUND_05UP))  <span class="comment"># 精确的最后一位为 0 或者 5 向上入，否者向下舍：5.39</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">&#x27;传入的是字符串正数时与 ROUND_UP 一致：&#x27;</span>,</span><br><span class="line">          Decimal(<span class="string">&#x27;5.391&#x27;</span>).quantize(Decimal(<span class="string">&#x27;0.00&#x27;</span>), ROUND_CEILING))  <span class="comment"># 5.40</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是字符串正数时与 ROUND_DOWN一致：&#x27;</span>,</span><br><span class="line">          Decimal(<span class="string">&#x27;5.399&#x27;</span>).quantize(Decimal(<span class="string">&#x27;0.00&#x27;</span>), ROUND_FLOOR))  <span class="comment"># 5.39</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是字符串负数时与 ROUND_DOWN 一致：&#x27;</span>,</span><br><span class="line">          Decimal(<span class="string">&#x27;-5.399&#x27;</span>).quantize(Decimal(<span class="string">&#x27;0.00&#x27;</span>),</span><br><span class="line">                                     ROUND_CEILING))  <span class="comment"># -5.39  趋近于正无穷</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是字符串负数时与 ROUND_UP 一致：&#x27;</span>,</span><br><span class="line">          Decimal(<span class="string">&#x27;-5.399&#x27;</span>).quantize(Decimal(<span class="string">&#x27;0.00&#x27;</span>),</span><br><span class="line">                                     ROUND_FLOOR))  <span class="comment"># -5.40  趋近于负无穷</span></span><br><span class="line">    print(<span class="string">&#x27;传入的是字符串与正负无关，最后一位始终进：&#x27;</span>,</span><br><span class="line">          Decimal(<span class="string">&#x27;-5.399&#x27;</span>).quantize(Decimal(<span class="string">&#x27;0.00&#x27;</span>), ROUND_UP))  <span class="comment"># -5.40</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># float_calculate()</span></span><br><span class="line">    <span class="comment"># decimal_calculate()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># float_info()</span></span><br><span class="line">    decimal_info()</span><br></pre></td></tr></table></figure>

<hr>
</div><div class="article-licensing box"><div class="licensing-title"><p>Python 浮点数精确运算解决方案</p><p><a href="https://www.orangeshare.cn/2018/01/08/python-fu-dian-shu-jing-que-yun-suan-jie-jue-fang-an/">https://www.orangeshare.cn/2018/01/08/python-fu-dian-shu-jing-que-yun-suan-jie-jue-fang-an/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Waldeinsamkeit</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2018-01-08</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2022-11-06</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/DataType/">DataType</a><a class="link-muted mr-2" rel="tag" href="/tags/Python/">Python</a></div><div class="notification is-danger">You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.</div></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/" alt="Alipay"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2018/01/09/python-zhong-de-yun-suan-fu-yi-ji-liu-cheng-kong-zhi/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Python 中的运算符以及流程控制</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2018/01/08/python-zhong-de-shen-qian-kao-bei-xiang-jie/"><span class="level-item">Python 中的深浅拷贝详解</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="notification is-danger">You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen  order-3 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="Waldeinsamkeit"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Waldeinsamkeit</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">113</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">13</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">43</p></a></div></div></nav></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#前记"><span class="level-left"><span class="level-item">1</span><span class="level-item">前记</span></span></a></li><li><a class="level is-mobile" href="#Python-近似机制"><span class="level-left"><span class="level-item">2</span><span class="level-item">Python 近似机制</span></span></a></li><li><a class="level is-mobile" href="#decimal-Module"><span class="level-left"><span class="level-item">3</span><span class="level-item">decimal Module</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#易错点"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">易错点</span></span></a></li><li><a class="level is-mobile" href="#设置有效位数"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">设置有效位数</span></span></a></li></ul></li><li><a class="level is-mobile" href="#You-Need-Know-More"><span class="level-left"><span class="level-item">4</span><span class="level-item">You Need Know More</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#decimal-数值（Decimal）"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">decimal 数值（Decimal）</span></span></a></li><li><a class="level is-mobile" href="#算术上下文（Context）"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">算术上下文（Context）</span></span></a></li><li><a class="level is-mobile" href="#信号"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">信号</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Python-浮点数和十进制模块测试"><span class="level-left"><span class="level-item">5</span><span class="level-item">Python 浮点数和十进制模块测试</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="When Art Meets Tech" height="28"></a><p class="is-size-7"><span>&copy; 2024 Waldeinsamkeit</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>